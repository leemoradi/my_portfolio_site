<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congressional Dashboard - Bills & Committees</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-card h3 {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #666;
            font-weight: 500;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .chart-container h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3rem;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 0 auto;
        }

        .committee-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin: 50px 0;
        }

        .error {
            background: rgba(255, 99, 132, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .last-updated {
            text-align: center;
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .charts-grid, .committee-charts {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Congressional Committee Analysis</h1>
            <p><strong>Real-time Committee Activity & Bill Processing Tracking</strong></p>
            
            <div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid #667eea; color: white;">
                <h3 style="margin: 0 0 10px 0; color: white; font-size: 1.1em;">Congressional Committee Analysis Dashboard</h3>
                <p style="margin: 0 0 10px 0; font-size: 0.95em; line-height: 1.5; opacity: 0.9;">
                    This dashboard provides comprehensive analysis of congressional committees and their bill processing activity. 
                    It tracks committee assignments, bill counts, and committee types across both House and Senate chambers, 
                    offering insights into how legislation moves through the congressional system.
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div>
                        <h4 style="margin: 0 0 5px 0; color: white; font-size: 0.9em;">Committee Activity Analysis:</h4>
                        <p style="margin: 0; font-size: 0.85em; line-height: 1.4; opacity: 0.9;">
                            This dashboard shows the top 10 most active committees, tracks bill counts per committee, 
                            compares House vs Senate committee activity, and displays committee type distribution.
                        </p>
                    </div>
                    <div>
                        <h4 style="margin: 0 0 5px 0; color: white; font-size: 0.9em;">Key Features:</h4>
                        <p style="margin: 0; font-size: 0.85em; line-height: 1.4; opacity: 0.9;">
                            The dashboard provides real-time committee data updates, interactive committee activity charts, 
                            committee type analysis (Standing, Select, Joint), and bill processing workflow insights.
                        </p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 15px;">
                <a href="index_auto.html" style="display: inline-block; margin: 0 10px; padding: 8px 15px; background-color: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: 8px; font-size: 0.9em; font-weight: bold;">Live Updates</a>
                <button id="autoRefreshBtn" style="display: inline-block; margin: 0 10px; padding: 8px 15px; background-color: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: 8px; font-size: 0.9em; font-weight: bold; border: none; cursor: pointer;">Auto-Refresh: OFF</button>
            </div>
        </div>

        <!-- Bill Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalBills">-</h3>
                <p>Total Bills</p>
            </div>
            <div class="stat-card">
                <h3 id="houseBills">-</h3>
                <p>House Bills</p>
            </div>
            <div class="stat-card">
                <h3 id="senateBills">-</h3>
                <p>Senate Bills</p>
            </div>
            <div class="stat-card">
                <h3 id="totalCommittees">-</h3>
                <p>Total Committees</p>
            </div>
            <div class="stat-card">
                <h3 id="houseCommittees">-</h3>
                <p>House Committees</p>
            </div>
            <div class="stat-card">
                <h3 id="senateCommittees">-</h3>
                <p>Senate Committees</p>
            </div>
        </div>

        <!-- Committee Charts -->
        <div class="committee-charts">
            <div class="chart-container">
                <h3>üìã Committee Activity</h3>
                <div class="chart-wrapper">
                    <canvas id="committeeActivityChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>üèõÔ∏è Committee Types</h3>
                <div class="chart-wrapper">
                    <canvas id="committeeTypesChart"></canvas>
                </div>
            </div>
        </div>

        <div class="last-updated">
            <p>Last updated: <span id="lastUpdated">-</span></p>
        </div>
    </div>

    <script>
        // Global variables for charts
        let committeeActivityChart, committeeTypesChart;

        // Fetch and display data
        async function loadDashboard() {
            try {
                // Load bill data
                const billResponse = await fetch('../data/latest_bills.json');
                const billData = await billResponse.json();
                
                // Load committee data
                const committeeResponse = await fetch('../data/committee_data.json');
                const committeeData = await committeeResponse.json();
                
                // Update statistics
                updateBillStats(billData);
                updateCommitteeStats(committeeData);
                
                // Create committee charts
                createCommitteeCharts(committeeData);

                // Update timestamp
                document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.querySelector('.container').innerHTML += `
                    <div class="error">
                        Error loading data. Please check if the data files exist and try again.
                    </div>
                `;
            }
        }

        function updateBillStats(data) {
            document.getElementById('totalBills').textContent = data.total_bills || 0;
            document.getElementById('houseBills').textContent = data.house_bills || 0;
            document.getElementById('senateBills').textContent = data.senate_bills || 0;
        }

        function updateCommitteeStats(data) {
            const summary = data.summary || {};
            document.getElementById('totalCommittees').textContent = summary.total_committees || 0;
            document.getElementById('houseCommittees').textContent = summary.house_committees || 0;
            document.getElementById('senateCommittees').textContent = summary.senate_committees || 0;
        }

        function createCommitteeCharts(data) {
            const committees = data.committees || {};
            const committeeTypes = data.committee_types || {};
            
            // Committee activity chart (top 10 most active)
            const committeeList = Object.values(committees);
            const sortedCommittees = committeeList
                .sort((a, b) => b.bill_count - a.bill_count)
                .slice(0, 10);
            
            const committeeCtx = document.getElementById('committeeActivityChart').getContext('2d');
            committeeActivityChart = new Chart(committeeCtx, {
                type: 'bar',
                data: {
                    labels: sortedCommittees.map(c => c.name.substring(0, 25) + '...'),
                    datasets: [{
                        label: 'Bills Processed',
                        data: sortedCommittees.map(c => c.bill_count),
                        backgroundColor: '#4BC0C0',
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 5
                            }
                        }
                    }
                }
            });

            // Committee types chart
            const typesCtx = document.getElementById('committeeTypesChart').getContext('2d');
            committeeTypesChart = new Chart(typesCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(committeeTypes),
                    datasets: [{
                        data: Object.values(committeeTypes).map(t => t.count),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'
                        ],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Load dashboard on page load
        document.addEventListener('DOMContentLoaded', loadDashboard);

        // Auto-refresh functionality
        let autoRefreshInterval = null;
        let isAutoRefreshOn = false;

        function toggleAutoRefresh() {
            const btn = document.getElementById('autoRefreshBtn');
            
            if (isAutoRefreshOn) {
                // Turn off auto-refresh
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                isAutoRefreshOn = false;
                btn.textContent = 'Auto-Refresh: OFF';
                btn.style.backgroundColor = 'rgba(255,255,255,0.2)';
            } else {
                // Turn on auto-refresh
                autoRefreshInterval = setInterval(loadDashboard, 30000);
                isAutoRefreshOn = true;
                btn.textContent = 'üîÑ Auto-Refresh: ON';
                btn.style.backgroundColor = 'rgba(76, 175, 80, 0.3)';
            }
        }

        // Add event listener to the auto-refresh button
        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('autoRefreshBtn');
            if (btn) {
                btn.addEventListener('click', toggleAutoRefresh);
            }
        });
    </script>
</body>
</html> 